---
title: "Projet MSPL: Diamants"   
author: "Lilian Ouraha, Doriane Richard, Reza Roudoci, Ahmed Ben Nacib"
date: "20 Mai 2025"
output: 
  pdf_document:
    toc: true  
    toc_depth: 3    
---
 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Introduction
Ce projet a été réalisé par des étudiants de L3 MIAGE dans le cadre du module MSPL, et porte sur les diamants.  
L’objectif de ce projet est d’identifier le ou les facteurs clés qui déterminent le prix d’un diamant parmi plusieurs variables telles que son carat, sa couleur, sa largeur et d'autres caractéristiques.  
Pour cela, nous avons utilisé un jeu de données trouvé sur Kaggle datant de 2017, qui contient plus de 58 000 observations et une dizaine de variables décrivant les caractéristiques physiques et esthétiques des diamants.  
Les variables sont les suivantes :  
- **price**:  Le prix du diamant en dollars ($326--$18,823)  
- **carat**:  Le poids du diamant en grammes (un carat = 0,2 gramme) (0.2--5.01)    
- **cut**:  La qualité de la taille du diamant, qui influence fortement la manière dont il reflète la lumière (Fair, Good, Very Good, Premium, Ideal).        
- **color**: La couleur du diamant varie du plus coloré au plus incolore (‘J’ (le moins bon) à ‘D’ (le meilleur)). Les diamants totalement incolores sont les plus rares.
D'autres couleurs naturelles (comme le bleu, rouge ou rose) sont appelées "fancy" et leur évaluation se fait selon des critères différents.  
- **clarity**:  Un indice mesurant la pureté du diamant (I1 (le pire), SI2, SI1, VS2, VS1, VVS2, VVS1, IF (le meilleur))  
- **x**: Longueur en mm (0--10.74)  
- **y**: Largeur mm (0--58.9)  
- **z**:  Profondeur en mm (0--31.8)   
- **depth**: Profondeur totale du diamant, exprimée en pourcentage par rapport à son diamètre moyen = z / ((x + y) / 2) = 2 * z / (x + y) (43–79)    
- **table**: Largeur de la facette supérieure, exprimée en pourcentage par rapport à la largeur du diamant (43–95)  
  
À partir de ce jeu de données, nous cherchons à répondre à la question suivante : "**Quel est le facteur le plus déterminant du prix d’un diamant ?**"  
 
## Methodologie
### Procédure de nettoyage des données
Avant de mener notre analyse, nous avons effectué plusieurs étapes de nettoyage afin de garantir la qualité et la fiabilité des données :  
- La première colonne du jeu de données était une variable d’index inutile, que nous avons supprimée car elle n’apportait aucune information pertinente.  
- Nous avons identifié et supprimé 20 lignes contenant des mesures physiques impossibles : certaines avaient une valeur de 0 pour l’une des dimensions (x, y ou z), ce qui est physiquement impossible pour un diamant réel.  
  
### Démarche scientifique
Nous avons d’abord observé que le carat (poids) est de loin le facteur le plus influent sur le prix d’un diamant.  
Pour pouvoir évaluer l’influence des autres variables, il était nécessaire de contrôler l’effet du carat, c’est-à-dire le neutraliser pour mieux comparer les autres critères.  
Pour cela, nous avons choisi de nous concentrer sur les diamants ayant un carat proche de 1, car ils sont les plus représentés dans le jeu de données.  

En se limitant à cette plage de carat, nous avons pu analyser l’impact des autres caractéristiques comme la taille (cut), la pureté (clarity) et la couleur (color) sur le prix.
   
Nous avons également conclu que parmi les mesures physiques (x, y, z, depth, table), c’est le carat qui reste le plus déterminant pour le prix.  
Ainsi, nous avons choisi de ne pas approfondir davantage les variables dimensionnelles individuelles, et de nous concentrer sur les variables qualitatives (cut, clarity, color) qui ont aussi un impact significatif.  

Notre analyse est donc centrée sur ces caractéristiques, après avoir tenu compte du carat.     
### Choix de représentation graphique
We have chosen to represent the most of the datas in a light blue, a color that remember diamonds.
## Analyse en programmation lettrée  

## Conclusion   

## References  
  

We first start by reading the input data
```{r, echo = FALSE}
library(tidyverse)
library(ggplot2)
diamonds_data <- read_delim("./data/diamonds_data.csv",delim=",");

# Ignore the first variable because it's useless (an index)
diamonds_data <- diamonds_data %>% select(-1)

# filter the x y and z variables only keeping the one greater than 0
diamonds_data <- diamonds_data %>%
  filter(x > 0 & y > 0 & z > 0)

# diamonds_data %>% arrange(desc(price)) %>% head(1000)
diamonds_data 
```


Now we create an histogram depending of the price 

```{r, echo = FALSE}
ggplot(diamonds_data, aes(x = price)) +
  geom_histogram(fill = "steelblue", color = "white") + # Draws the histogram with bars of width 500 filled with steel blue and white borders
  scale_x_continuous(limits = c(300, 19000), breaks = seq(0, 19000, 2000)) + # Sets the X-axis limits (from 300 to 19,000) and tick marks every 2000
  labs(
    title = "Répartition du prix des diamants",
    x = "Prix ($)",
    y = "Nombre de diamants"
  ) +
  theme_minimal(base_size = 16)
```

Linear model to estimate the overall trend depending of the carat using  
```{r, echo = FALSE}
# Create personalised intervals: 0 → 4.1 incrementing of 0.5, then a final jump until the maximum
breaks <- c(seq(0.1, 4.1, by = 0.5), max(diamonds_data$carat) + 0.1)

diamonds_data %>%
  mutate(carat_bin = cut(carat, breaks = breaks, include.lowest = TRUE)) %>%
  group_by(carat_bin) %>%
  summarise(mean_price = mean(price)) %>%
  ggplot(aes(x = carat_bin, y = mean_price, group = 1)) +
  geom_line(color = "blue", linewidth = 2) + 
  labs(
    title = "Prix moyen de diamants en fonction du carat",
    x = "Carat",
    y = "Prix moyen ($)"
  ) +
  theme_minimal(base_size = 15)

```

```{r, echo = FALSE}
# Create interval step of 0.2 for the carat
breaks <- seq(0.2, max(diamonds_data$carat)+0.2, by = 0.2)

# Ajouter une colonne avec les tranches de carat
diamonds_data %>%
  mutate(carat_bin = cut(carat, breaks = breaks, include.lowest = TRUE)) %>%
  group_by(carat_bin) %>%
  summarise(count = n()) %>%
  ggplot(aes(x = carat_bin, y = count)) +
  geom_bar(stat = "identity", fill = "orchid", color = "black") +
  labs(
    title = "Nombre de diamants par tranche de carat (intervalle de 0.2)",
    x = "Tranche de carat",
    y = "Nombre de diamants"
  ) +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
```{r, echo = FALSE}

# Take only the carat between 0.9 and 1.1
diamonds_filtered <- diamonds_data %>%
  filter(carat >= 0.9 & carat <= 1.1) %>%
  mutate(cut = fct_relevel(cut, "Fair", "Good", "Very Good", "Premium", "Ideal"))

# Graphique boxplot
ggplot(diamonds_filtered, aes(x = cut, y = price)) +
  geom_boxplot(fill = "lightblue") +
  labs(
    title = "Prix selon la qualité de coupe (à carat ~1)",
    x = "Qualité de coupe",
    y = "Prix ($)"
  ) +
  theme_minimal(base_size = 15)
```

```{r, echo = FALSE}

# Filter on ~1 carat and reorganize by level of clarity ascending
diamonds_filtered <- diamonds_data %>%
  filter(carat >= 0.9 & carat <= 1.1) %>%
    mutate(color = fct_relevel(color, "J", "I", "H", "G", "F", "E", "D"))

# Boxplot for the clarity clarity
ggplot(diamonds_filtered, aes(x = color, y = price)) +
  geom_boxplot(fill = "lightblue") +
  labs(
    title = "Prix selon la couleur (à carat  ~1)",
    x = "Clarté",
    y = "Prix ($)"
  ) +
  theme_minimal(base_size = 15)

``` 

```{r, echo = FALSE}

# Filter on ~1 carat and reorganize by level of clarity ascending
diamonds_filtered <- diamonds_data %>%
  filter(carat >= 0.9 & carat <= 1.1) %>%
  mutate(clarity = fct_relevel(clarity, "I1", "SI2", "SI1", "VS2", "VS1", "VVS2", "VVS1", "IF"))

# Boxplot for the clarity clarity
ggplot(diamonds_filtered, aes(x = clarity, y = price)) +
  geom_boxplot(fill = "lightblue") +
  labs(
    title = "Prix selon la clarté (à carat  ~1)",
    x = "Clarté",
    y = "Prix ($)"
  ) +
  theme_minimal(base_size = 15)

```




